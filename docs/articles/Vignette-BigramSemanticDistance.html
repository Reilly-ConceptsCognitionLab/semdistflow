<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="semdistflow">
<title>Semdistflow: Semantic distance from natural language samples • semdistflow</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Semdistflow: Semantic distance from natural language samples">
<meta property="og:description" content="semdistflow">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">semdistflow</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Vignette-BigramSemanticDistance.html">Semdistflow: Semantic distance from natural language samples</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Semdistflow: Semantic distance from natural language samples</h1>
                        <h4 data-toc-skip class="author">Jamie Reilly,
Celia Litovsky, Ann Marie Finley, Bonnie Zuckerman</h4>
            
      
      
      <div class="d-none name"><code>Vignette-BigramSemanticDistance.Rmd</code></div>
    </div>

    
    
<p>Semdistflow is designed to read in one or more language transcripts,
clean and format them, and then output a vector of semantic distances
corresponding to every running bigram in the language sample. For
example, let’s say you have a text file composed of just one sentence:
<br></p>
<p><img src="../../../Semdistflow%20Package%20Development/semdistflow/articles/roses_red.png" style="width:40.0%"></p>
<ol style="list-style-type: decimal">
<li>
<span style="color:red">readme()</span> reads the txt file into R,
appends a document id based on its filename and formats the text as a
dataframe. <br>
</li>
<li>
<span style="color:red">cleanme() </span> uses many regular
expressions to clean and format the text. These include omitting
contractions, converting to lowercase, omitting numbers, omitting
stopwords, etc. <br>
</li>
<li>
<span style="color:red">distme()</span> computes two metrics of
semantic distance for each running pair of words in the language sample
you just cleaned. These are outputted as a vector of word pairs.</li>
</ol>
<div class="section level2">
<h2 id="step-1-prep-your-texts">Step 1: Prep your texts<a class="anchor" aria-label="anchor" href="#step-1-prep-your-texts"></a>
</h2>
<p>Semdistflow works on language transcripts formatted as txt files. The
first function you will use readme() will append the filename of each
txt file as a document_id to the subsequent dataframe that is read into
R. This allows users to run many distinct documents at once, maintaining
independence of each language transcript. <br></p>
<p>We recommend being systematic and deliberate about your processing
pipeline and filenaming conventions. Language transcripts can easily
proliferate. A sensible approach is to create a folder such as
‘my_texts’ in the project directory where you plan on processing your
big text analysis project. Store your preprocessed files in that folder.
Nominally, setting up a structure like this is probably a good idea.</p>
<p><img src="../../../Semdistflow%20Package%20Development/semdistflow/articles/My_Texts.png" style="width:40.0%"></p>
<p>Remember that readme() will look for any txt file in whatever folder
name you specify, so it is important that once you are finished
processing a txt file that you move it out of ‘my_texts’ into another
folder of your choice (e.g., ‘texts_processed’). <br></p>
<p>You have several options when reading text files into R using our
readme() function. If you just run ‘readme()’, R will look for any text
files in your root directory. In contrast, the more systematic approach
would be to dump your target files into a specific subfolder you create
(my_texts) and call the function within that folder using: <br></p>
<p>readme(./my_texts) <br></p>
</div>
<div class="section level2">
<h2 id="step-2-readme-read-in-your-texts">Step 2: readme() read in your texts<a class="anchor" aria-label="anchor" href="#step-2-readme-read-in-your-texts"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mytexts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readme.html">readme</a></span><span class="op">(</span><span class="op">)</span>  <span class="co">#all text files in the root directory</span></span>
<span><span class="va">mytexts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readme.html">readme</a></span><span class="op">(</span><span class="va">.</span><span class="op">/</span><span class="va">my_texts</span><span class="op">)</span>  <span class="co">#all text files in the 'my_texts' folder of your directory</span></span></code></pre></div>
<p>If readme() did its job, the resulting dataframe will have two
columns “doc_id” and “doc_text”. The doc_id is a distinct identifier
corresponding to the filename of each text file you read into R. The
doc_text corresponds to the raw (uncleaned and untouched) text within
text file. The output should have a structure like this: <br></p>
<p><img src="../../../Semdistflow%20Package%20Development/semdistflow/articles/roses_readme.png" style="width:70.0%"><br> As you can
see, R read in the text file, appended a doc_id and inputted the raw
text under the column name, doc_text. Getting data into R is often half
the battle, especially when working with string data. It’s not crucial
that you use the readme() function. You can use semdistflow to clean and
compute distance on any character vector as long as it is nested within
a dataframe with column names “doc_id” and “doc_text”. Any other
document identifiers will be retained but ignored in subsequent steps.
<br><br></p>
<p>For the intrepid, here’s the code that operates under the hood of
readme()</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">readme</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">folder_name</span> <span class="op">=</span> <span class="st">"my_texts"</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">file_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">folder_name</span>, pattern <span class="op">=</span> <span class="st">"*.txt"</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co">#list files with .txt ending</span></span>
<span>  <span class="va">textdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">file_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, collapse<span class="op">=</span><span class="st">" "</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span> <span class="co">#apply readlines over the file list, no warning if last line is not complete</span></span>
<span>  <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setattr.html" class="external-link">setattr</a></span><span class="op">(</span><span class="va">textdata</span>, <span class="st">"names"</span>, <span class="va">file_list</span><span class="op">)</span> <span class="co">#add names attribute to textdata from file_list</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">file_list</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">file_list</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="fu">setattr</span><span class="op">(</span><span class="va">DT</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, <span class="va">y</span>, <span class="va">file_list</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">y</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span> <span class="co">#set names attribute over the list</span></span>
<span>  <span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>doc_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">textdata</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="va">textdata</span><span class="op">)</span><span class="op">)</span>, doc_text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">textdata</span><span class="op">)</span>, row.names <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="co">#convert to dataframe where names attribute is doc_id and textdata is text</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">df1</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step-3-cleanme-clean-and-format-texts">Step 3: cleanme() clean and format texts<a class="anchor" aria-label="anchor" href="#step-3-cleanme-clean-and-format-texts"></a>
</h2>
<p>Now you are cooking. Your text is in a dataframe with an identifier.
You are ready to clean the data. The cleanme() step does lots of
substitutions and transformations using regular expressions. We adapted
a custom stopword list which removes function words (e.g., the, a) and
many other ‘empty’ lexical forms. If you want to know exactly what is
getting cleaned and swapped during this process, you can <a href="https://psyarxiv.com/6fuhv" class="external-link">read our preprint by linking here to
PsyArXiv</a></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mycleantxt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cleanme.html">cleanme</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span> <span class="co"># dat is a dataframe prepped from readme()</span></span></code></pre></div>
<p>Look what cleanme() did to our original doc_text. First you’ll notice
that the dataframe has a new column called doc_clean. Then if you look
closely at doc_clean you’ll notice some differences. There is no
punctuation, and the stopwords ‘and’ and ‘are’ have been omitted.
Magic!</p>
<p><img src="../../../Semdistflow%20Package%20Development/semdistflow/articles/cleanme_dat.png" style="width:70.0%"><br></p>
<p><br> Here’s the annotated code showing omissions, substitutions and
all other steps under the hood of the cleanme() function. Some of these
code snips involve borrowed package dependencies from packages like
stringi or textclean. Most are custom regex.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cleanme</span><span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"omissions_2023.rda"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"replacements_2023.rda"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">omissions</span> <span class="op">&lt;-</span> <span class="va">omissions_2023</span></span>
<span>  <span class="va">replacements</span> <span class="op">&lt;-</span> <span class="va">replacements_2023</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Performing text cleaning.... sit tight!"</span><span class="op">)</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">x</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">doc_id</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">$</span><span class="va">doc_text</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="co">#to lower</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\""</span>, <span class="st">" "</span>, <span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\n"</span>, <span class="st">" "</span>, <span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">textclean</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/textclean/man/replace_date.html" class="external-link">replace_date</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">stringi</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_replace.html" class="external-link">stri_replace_all_regex</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"^"</span> <span class="op">%s+%</span> <span class="va">replacements</span><span class="op">$</span><span class="va">target</span> <span class="op">%s+%</span> <span class="st">"$"</span>, <span class="va">replacements</span><span class="op">$</span><span class="va">replacement</span>, vectorize_all <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"`"</span>, <span class="st">"'"</span>, <span class="va">x</span><span class="op">)</span>  <span class="co"># replaces tick marks with apostrophe for contractions</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"(\\d)(\\.)"</span>, <span class="st">""</span>, <span class="va">x</span><span class="op">)</span>   <span class="co">#look for period adjacent to any digit, replace with nothing</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">textclean</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/textclean/man/replace_contraction.html" class="external-link">replace_contraction</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="co">#replace contractions</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"([[:alpha:]])([[:punct:]])"</span>, <span class="st">"\\1 \\2"</span>, <span class="va">x</span><span class="op">)</span> <span class="co">#add a space between any alphabetic character and punctuation</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"-"</span>, <span class="st">" "</span>, <span class="va">x</span><span class="op">)</span> <span class="co">#replace all hyphens with spaces</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">tm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tm/man/removeWords.html" class="external-link">removeWords</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">omissions</span><span class="op">$</span><span class="va">target</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\d+(st|nd|rd|th)"</span>, <span class="st">" "</span>, <span class="va">x</span><span class="op">)</span> <span class="co">#omits 6th, 23rd, ordinal numbers</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"[^a-zA-Z;.,]"</span>, <span class="st">" "</span>, <span class="va">x</span><span class="op">)</span> <span class="co">#omit numbers and most punctuation, retain alphabetic chars, comma, semicolon, periods</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\b[a-z]\\b{1}"</span>, <span class="st">" "</span>, <span class="va">x</span><span class="op">)</span> <span class="co">#omits any singleton alphabetic character</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\;"</span>, <span class="st">"\\."</span>, <span class="va">x</span><span class="op">)</span> <span class="co">#replace semicolons with periods</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\s{2,}"</span>, <span class="st">" "</span>, <span class="va">x</span><span class="op">)</span> <span class="co">#replace two or more spaces with a single space</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">" "</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">x</span>,collapse<span class="op">=</span><span class="st">" "</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"person person"</span>, <span class="st">"person"</span>, <span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"people people"</span>, <span class="st">"people"</span>, <span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"(.*)(, and* )(\\w{1,}\\s\\w{1,})"</span>, <span class="st">"\\1. \\3"</span>, <span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"(.*)(, but* )(\\w{1,}\\s\\w{1,})"</span>, <span class="st">"\\1. \\3"</span>, <span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"(.*)(,* because* )(\\w{1,}\\s\\w{1,})"</span>, <span class="st">"\\1. \\3"</span>, <span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"(.*)(,* then* )(\\w{1,}\\s\\w{1,})"</span>, <span class="st">"\\1. \\3"</span>, <span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">","</span>, <span class="st">""</span>, <span class="va">x</span><span class="op">)</span> <span class="co"># remove commas</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"([[:punct:]])"</span>, <span class="st">""</span>, <span class="va">x</span><span class="op">)</span> <span class="co"># remove periods</span></span>
<span>  <span class="va">doc_clean</span> <span class="op">&lt;-</span> <span class="fu">tm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tm/man/stripWhitespace.html" class="external-link">stripWhitespace</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">cleandoc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">doc_clean</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">cleandoc</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="step-4-distme-computes-semantic-distances">Step 4: distme() computes semantic distances<a class="anchor" aria-label="anchor" href="#step-4-distme-computes-semantic-distances"></a>
</h2>
<p>distme() works some serious magic. It takes your cleantxt and by
default lemmatizes it then transforms it into a running vector of
content words. After each running pair of content words we append two
metrics of semantic distance. <br></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mydistances</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/distme.html">distme</a></span><span class="op">(</span><span class="va">mycleantexts</span><span class="op">)</span></span></code></pre></div>
<p>distme() takes two arguments. The first is an input text. The second
is whether or not to lemmatize the text before running distance norms on
it. By default, lemmatize=T. This lemmatizes all of your words
converting them to their dictionary entries. This helps with term
aggregation so that we have as few missing observations from
morphological derivatives as possible. if you do not specify the
lemmatize=T argument it defaults to true and will lemmatize your data.
If you want distme() to just compute distances on the words you feed it
then run distme(dat, lemmatize=F)</p>
<p>The output is a tibble that looks like this…. <br><img src="../../../Semdistflow%20Package%20Development/semdistflow/articles/tibble_vig.png" style="width:80.0%"><br></p>
<p>Let’s break this down by column name. Here they are… <img src="../../../Semdistflow%20Package%20Development/semdistflow/articles/colnames_dist.png" style="width:80.0%"><br></p>
<p>The function for distme() is a bit complex. It computes cosine
distance between the semantic vectors between every running pair of
words in the language sample you feed it. Here it is!</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">distme</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">targetdf</span>, <span class="va">lemmatize</span><span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Loading lookup databases and joining your data to SemDist15 and Glowca"</span><span class="op">)</span></span>
<span>  <span class="co">#load lookup databases</span></span>
<span>  <span class="va">glowca_v1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu">here</span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"glowca_vol1_2023.rda"</span><span class="op">)</span><span class="op">)</span> <span class="co">#rounded 5,subtlex matched 60k</span></span>
<span>  <span class="va">glowca_v2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu">here</span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"glowca_vol2_2023.rda"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">glowca</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">glowca_v1</span>, <span class="va">glowca_v2</span><span class="op">)</span></span>
<span>  <span class="va">sd15</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu">here</span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"semdist15_2023.rda"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">lemmatize</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co">#groups by factor variables and unlists the string, one word per row</span></span>
<span>    <span class="va">dat</span> <span class="op">&lt;-</span><span class="va">targetdf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">doc_id</span>, <span class="va">doc_text</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">tidytext</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/unnest_tokens.html" class="external-link">unnest_tokens</a></span><span class="op">(</span><span class="va">word</span>, <span class="va">doc_clean</span><span class="op">)</span></span>
<span>    <span class="co">#lemmatizes target dataframe on column labeled 'lemma1'</span></span>
<span>    <span class="va">dat2</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>lemma1 <span class="op">=</span> <span class="fu">textstem</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/textstem/man/lemmatize_words.html" class="external-link">lemmatize_words</a></span><span class="op">(</span><span class="va">word</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="co">#join semdist15 and glowca lookup databases with target input dataframe</span></span>
<span>    <span class="va">joindf_semdist15</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">dat2</span>, <span class="va">sd15</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lemma1"</span><span class="op">=</span><span class="st">"word"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">joindf_glowca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">dat2</span>, <span class="va">glowca</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lemma1"</span><span class="op">=</span><span class="st">"word"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="co">#Select numeric columns for cosine calculations, eliminate columns with string data</span></span>
<span>    <span class="va">dat_sd15</span> <span class="op">&lt;-</span> <span class="va">joindf_semdist15</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html" class="external-link">select_if</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span></span>
<span>    <span class="va">datglo</span> <span class="op">&lt;-</span> <span class="va">joindf_glowca</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html" class="external-link">select_if</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span></span>
<span>    <span class="co">#convert join dataframes containing hyperparameter values (glowca and sd15) to matrices</span></span>
<span>    <span class="va">mat_sd15</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">dat_sd15</span><span class="op">)</span></span>
<span>    <span class="va">mat_glo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">datglo</span><span class="op">)</span></span>
<span>    <span class="co">#compute cosine distance for each running pair of words in sd15 and glowca</span></span>
<span>    <span class="va">vals_sd15</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mat_sd15</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="fu">lsa</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lsa/man/cosine.html" class="external-link">cosine</a></span><span class="op">(</span><span class="va">mat_sd15</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span>,<span class="op">]</span>,  <span class="va">mat_sd15</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">vals_glo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mat_glo</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="fu">lsa</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lsa/man/cosine.html" class="external-link">cosine</a></span><span class="op">(</span><span class="va">mat_glo</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span>,<span class="op">]</span>, <span class="va">mat_glo</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="co">#Convert matrices back to dataframes</span></span>
<span>    <span class="va">vals_sd15</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">vals_sd15</span><span class="op">)</span></span>
<span>    <span class="va">vals_glo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">vals_glo</span><span class="op">)</span></span>
<span>    <span class="co">#Rename first column of cosine distance values</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">vals_sd15</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Sd15_Cosine"</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">vals_glo</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Glo_Cosine"</span></span>
<span>    <span class="co">#Add NA to final row to match length, there is no pairwise distance for final observation</span></span>
<span>    <span class="va">vals_sd15</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">vals_sd15</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span>    <span class="va">vals_glo</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">vals_glo</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span>    <span class="co">#Reverse scale the cosine values for gloca and sd15, subtract each obs from max (1)</span></span>
<span>    <span class="va">sd15vals</span> <span class="op">&lt;-</span> <span class="va">vals_sd15</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Sd15_CosRev0Score<span class="op">=</span> <span class="fl">1</span><span class="op">-</span><span class="va">Sd15_Cosine</span><span class="op">)</span></span>
<span>    <span class="va">glowcavals</span> <span class="op">&lt;-</span> <span class="va">vals_glo</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Glowca_CosRev0Score <span class="op">=</span> <span class="fl">1</span><span class="op">-</span><span class="va">Glo_Cosine</span><span class="op">)</span></span>
<span>    <span class="co">#Rebuild the dataframe creating bigram columns, cbind words to their cosine values</span></span>
<span>    <span class="va">dat3</span><span class="op">&lt;-</span> <span class="va">dat2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>lemma2 <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lead</a></span><span class="op">(</span><span class="va">lemma1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co">#rebuild dataframe, cast lead (+1) bigram</span></span>
<span>    <span class="co">#Bind the sd15 cosine data to the original dataframe</span></span>
<span>    <span class="va">mydists_lemmatized</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">dat3</span>, <span class="va">sd15vals</span>, <span class="va">glowcavals</span><span class="op">)</span></span>
<span>    <span class="co">#Make last word of each text NA so we don't include cosine calculations between texts</span></span>
<span>    <span class="va">mydists_lemmatized</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">doc_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>lemma2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="va">lemma2</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Sd15_Cosine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="va">Sd15_Cosine</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Sd15_CosRev0Score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="va">Sd15_CosRev0Score</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Glo_Cosine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="va">Glo_Cosine</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Glowca_CosRev0Score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="va">Glowca_CosRev0Score</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="va">ungroup</span> <span class="op">-&gt;</span> <span class="va">mydists_lemmatized_NAatend</span></span>
<span>    <span class="co">#output a formatted dataframe</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">mydists_lemmatized_NAatend</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">lemmatize</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Loading lookup databases and joining your data to SemDist15 and Glowca"</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co">#groups by factor variables and unlists the string, one word per row</span></span>
<span>    <span class="va">dat</span> <span class="op">&lt;-</span><span class="va">targetdf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">doc_id</span>, <span class="va">doc_text</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">tidytext</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/unnest_tokens.html" class="external-link">unnest_tokens</a></span><span class="op">(</span><span class="va">word</span>, <span class="va">doc_clean</span><span class="op">)</span></span>
<span>    <span class="co">#join semdist15 and glowca lookup databases with target input dataframe</span></span>
<span>    <span class="va">joindf_semdist15</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">dat2</span>, <span class="va">semdist15_new</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"word1"</span><span class="op">=</span><span class="st">"word"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">joindf_glowca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">dat2</span>, <span class="va">glowca_lite</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"word1"</span><span class="op">=</span><span class="st">"word"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="co">#Select numeric columns for cosine calculations, eliminate columns with string data</span></span>
<span>    <span class="va">dat_sd15</span> <span class="op">&lt;-</span> <span class="va">joindf_semdist15</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html" class="external-link">select_if</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span></span>
<span>    <span class="va">datglo</span> <span class="op">&lt;-</span> <span class="va">joindf_glowca</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html" class="external-link">select_if</a></span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Computing Distances.... Be patient!!!"</span><span class="op">)</span></span>
<span>    <span class="co">#convert join dataframes containing hyperparameter values (glowca and sd15) to matrices</span></span>
<span>    <span class="va">mat_sd15</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">dat_sd15</span><span class="op">)</span></span>
<span>    <span class="va">mat_glo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">datglo</span><span class="op">)</span></span>
<span>    <span class="co">#compute cosine distance for each running pair of words in sd15 and glowca</span></span>
<span>    <span class="va">vals_sd15</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mat_sd15</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="fu">lsa</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lsa/man/cosine.html" class="external-link">cosine</a></span><span class="op">(</span><span class="va">mat_sd15</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span>,<span class="op">]</span>,  <span class="va">mat_sd15</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">vals_glo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mat_glo</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="fu">lsa</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lsa/man/cosine.html" class="external-link">cosine</a></span><span class="op">(</span><span class="va">mat_glo</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span>,<span class="op">]</span>, <span class="va">mat_glo</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="co">#Convert matrices back to dataframes</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"So far so good... Now building output dataframe"</span><span class="op">)</span></span>
<span>    <span class="va">vals_sd15</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">vals_sd15</span><span class="op">)</span></span>
<span>    <span class="va">vals_glo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">vals_glo</span><span class="op">)</span></span>
<span>    <span class="co">#Rename first column of cosine distance values</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">vals_sd15</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Sd15_Cosine"</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">vals_glo</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Glo_Cosine"</span></span>
<span>    <span class="co">#Add NA to final row to match length, there is no pairwise distance for final observation</span></span>
<span>    <span class="va">vals_sd15</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">vals_sd15</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span>    <span class="va">vals_glo</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">vals_glo</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span>    <span class="co">#Reverse scale the cosine values for gloca and sd15, subtract each obs from max (1)</span></span>
<span>    <span class="va">sd15vals</span> <span class="op">&lt;-</span> <span class="va">vals_sd15</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Sd15_CosRev0Score<span class="op">=</span> <span class="fl">1</span><span class="op">-</span><span class="va">Sd15_Cosine</span><span class="op">)</span></span>
<span>    <span class="va">glowcavals</span> <span class="op">&lt;-</span> <span class="va">vals_glo</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Glowca_CosRev0Score <span class="op">=</span> <span class="fl">1</span><span class="op">-</span><span class="va">Glo_Cosine</span><span class="op">)</span></span>
<span>    <span class="co">#Rebuild the dataframe creating bigram columns, cbind words to their cosine values</span></span>
<span>    <span class="va">dat3</span><span class="op">&lt;-</span> <span class="va">dat2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>word2 <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lead</a></span><span class="op">(</span><span class="va">word1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co">#rebuild dataframe, cast lead (+1) bigram</span></span>
<span>    <span class="co">#Bind the sd15 cosine data to the original dataframe</span></span>
<span>    <span class="va">mydists_unlemmatized</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">dat3</span>, <span class="va">sd15vals</span>, <span class="va">glowcavals</span><span class="op">)</span></span>
<span>    <span class="va">mydists_unlemmatized</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">doc_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>lemma2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="va">lemma2</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Sd15_Cosine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="va">Sd15_Cosine</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Sd15_CosRev0Score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="va">Sd15_CosRev0Score</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Glo_Cosine <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="va">Glo_Cosine</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Glowca_CosRev0Score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="va">Glowca_CosRev0Score</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="va">ungroup</span> <span class="op">-&gt;</span> <span class="va">mydists_unlemmatized_NAatend</span></span>
<span>    <span class="co">#output a formatted dataframe</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">mydists_unlemmatized_NAatend</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Bonnie M. Zuckerman, Jamie Reilly, Celia P. Litovsky, Ann Marie Finley.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
